{% extends 'base.html' %}
{% load static %}

{% block head %}
  <style>
    .leaflet-control-layers-expanded {
      background: #374151;
      color: #fff;
    }
    .leaflet-control-layers-selector {
      margin: 2px;
      top: 0;
    }
    .leaflet-bar a {
      background: #374151;
      color: #fff;
    }
    .leaflet-bar a:hover,
    .leaflet-bar a:focus {
      color: #374151;
    }
    [type='checkbox'],
    [type='radio'] {
      background-color: #374151;
    }
    [type='checkbox']:focus,
    [type='radio']:focus {
      --tw-ring-color: none;
    }
    .dark [type='checkbox']:checked,
    .dark [type='radio']:checked,
    [type='checkbox']:checked,
    [type='radio']:checked {
      background-color: #1f2937;
    }
  </style>
  <script src="{% static 'leaflet/plugins/svg-icons.js' %}"></script>
{% endblock %}

{% block main %}
{% endblock %}

{% block content %}
  {{sesizare_js|json_script:"sesizare"}}
  <section class="bg-white dark:bg-gray-900">
    <div class="max-w-screen-xl px-4 py-8 mx-auto lg:py-12 lg:px-6">
      <div class="max-w-screen-md mx-auto mb-2 text-center lg:mb-12">
        <h2 class="mb-4 text-3xl font-extrabold tracking-tight text-gray-900 dark:text-white">{{ sesizare.name }}</h2>
        <h4 class="text-lg font-semibold tracking-tight text-gray-900 dark:text-white"><span class="h-4 w-4 rounded-full inline-block mr-2 {{ sesizare.status.culoare }}"></span>{{ sesizare.status }}</h4>
      </div>
    </div>
    <div class="max-w-screen-xl px-4 py-8 mx-auto space-y-6 lg:space-y-2 lg:py-6 lg:px-6">
      <div class="items-center">
        <div class="text-gray-500 sm:text-lg dark:text-gray-400">
          <div id="map" style="height: 550px;"></div>
        </div>
      </div>
      {% if request.user.is_authenticated %}
      <p class="font-light lg:text-xl dark:text-gray-400">Latitudine: {{ sesizare.latitudine }} | Longitudine: {{ sesizare.longitudine }}</p>
      <div class="flex content-center">
        <a href="https://www.waze.com/ul?ll={{ sesizare.latitudine }}%2C{{ sesizare.longitudine }}&navigate=yes&zoom=17" target="_blank">
          <img class="h-10 w-10" src="{% static 'images/waze.png' %}" alt="">  
        </a>
        <a href="https://www.google.com/maps/dir/?api=1&destination={{ sesizare.latitudine }}%2C{{ sesizare.longitudine }}" target="_blank">
          <img class="h-10 w-10 text-center" src="{% static 'images/google.png' %}" alt="">  
        </a>
      </div>
      {% endif %}
    </div>
  </section>
  <section class="bg-gray-50 dark:bg-gray-800">
    <div class="max-w-screen-xl px-4 py-8 mx-auto space-y-12 lg:space-y-20 lg:py-24 lg:px-6">
      {% if request.user.is_authenticated %}
        <div class="flex flex-col lg:grid lg:grid-cols-2 gap-8">
          <article id="raport-voluntar" class="mx-auto w-full max-w-2xl format format-sm sm:format-base lg:format-lg format-blue dark:format-invert">
            {% if raport %}
              <p class="mb-8 font-light lg:text-xl dark:text-gray-400">Voluntar: {{ raport.voluntar }}</p>
              <p class="mb-8 font-light lg:text-xl dark:text-gray-400">Tip conflict: {{ raport.tip_conflict }}</p>
              <p class="mb-8 font-light lg:text-xl dark:text-gray-400">Specie identificată: {{ raport.specie_identificata }}</p>
              <p class="mb-8 font-light lg:text-xl dark:text-gray-400">Număr indivizi: {{ raport.numar_indivizi }}</p>
              <p class="mb-8 font-light lg:text-xl dark:text-gray-400">Observații voluntar: {{ raport.observatii_specialist }}</p>
              <a 
                hx-get="{% url 'completeaza_raport' raport.pk %}"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                hx-push-url="true"
                hx-target="#raport-voluntar"
                hx-swap="innerHTML"
                hx-on:htmx:after-request="initFlowbite();"
                class="py-2 px-3 flex items-center text-sm font-medium text-center text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 cursor-pointer">
                <svg class="w-4 h-4 mr-2 -ml-0.5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
                Modifică raport
              </a>
            {% else %}
            <div class="flex items-center space-x-4">
              <form method="POST" action="{% url 'preia' sesizare.pk %}">
                {% csrf_token %}
                {{ preia_sesizare.as_p }}
                <button type="submit" class="py-2 px-3 flex items-center text-sm font-medium text-center text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">
                  <svg class="w-4 h-4 mr-2 -ml-0.5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                    <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                  </svg>Preia sesizare
                </button>
              </form>
            </div>
            {% endif %}
          </article>
          <article class="mx-auto w-full max-w-2xl format format-sm sm:format-base lg:format-lg format-blue dark:format-invert">
            <header class="mb-4 lg:mb-6 not-format">
              <address class="flex items-center mb-6 not-italic">
                <div class="inline-flex items-center mr-3 text-sm text-gray-900 dark:text-white">
                  <div>
                    <div class="text-base text-gray-500 dark:text-gray-400">
                      <time pubdate datetime="2022-02-08" title="February 8th, 2022">{{ sesizare.created }}</time>
                    </div>
                    <p class="text-base text-gray-500 dark:text-gray-400"></p>
                  </div>
                </div>
              </address>
              <img src="{{ sesizare.image.image.url }}" alt="" />
            </header>
            <p class="mb-8 font-light lg:text-xl dark:text-gray-400">{{ sesizare.description }}</p>
          </article>
        {% else %}
        <div class="flex flex-col">
        <article class="mx-auto w-full max-w-2xl format format-sm sm:format-base lg:format-lg format-blue dark:format-invert">
          <header class="mb-4 lg:mb-6 not-format">
            <address class="flex items-center mb-6 not-italic">
              <div class="inline-flex items-center mr-3 text-sm text-gray-900 dark:text-white">
                <div>
                  <div class="text-base text-gray-500 dark:text-gray-400">
                    <time pubdate datetime="2022-02-08" title="February 8th, 2022">{{ sesizare.created }}</time>
                  </div>
                  <p class="text-base text-gray-500 dark:text-gray-400"></p>
                </div>
              </div>
            </address>
            <img src="{{ sesizare.image.image.url }}" alt="" />
          </header>
          <p class="mb-8 font-light lg:text-xl dark:text-gray-400">{{ sesizare.description }}</p>
        </article>
      </div>
      {% endif %}
    </div>
  </section>
{% endblock %}

{% block javascript %}
  <script src="{% static 'js/leaflet/sesizare_list.js'%}"></script>
{% endblock %}
